<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SEN MARCH√â ‚Äî Marketplace</title>
  <meta name="description" content="SEN MARCH√â - Marketplace locale. HTML5, CSS3, JavaScript vanilla. Panier, filtres, recherche en temps r√©el." />

  <style>

    /* ---------- FOOTER ---------- */
    footer{margin-top:36px;padding:28px 20px;background:linear-gradient(180deg,#f8fbff,#f0f6ff)}
    .foot-wrap{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;gap:18px;align-items:center}
    .small{color:var(--muted)}
    :root{
      --primary: linear-gradient(135deg,#0066ff 0%,#00b4ff 100%);
      --accent: #0d6efd;
      --muted:#6b7280;
      --card-bg: #ffffff;
      --glass: rgba(255,255,255,0.7);
      --radius: 12px;
      --shadow: 0 8px 24px rgba(2,6,23,0.08);
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#0f172a;background:linear-gradient(180deg,#f7fbff 0%,#f0f6ff 100%)}

    /* ---------- NAVBAR ---------- */
    header{
      position:sticky;top:0;z-index:1000;backdrop-filter: blur(6px);
      background: rgba(255,255,255,0.7);
      box-shadow: 0 2px 6px rgba(15,23,42,0.05);
    }

    .nav{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px 20px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700}
    .logo{width:44px;height:44px;border-radius:10px;background:var(--primary);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}

    nav ul{display:flex;gap:18px;list-style:none;padding:0;margin:0;align-items:center}
    nav a{color:#0f172a;text-decoration:none;font-weight:600;cursor:pointer}

    .search-wrap{display:flex;align-items:center;gap:12px}
    .search{padding:8px 12px;border-radius:10px;border:1px solid #e6eefc;background:white;min-width:220px}

    .cart-btn{position:relative;padding:8px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,#0d6efd,#007bff);color:white;cursor:pointer}
    .badge{position:absolute;right:6px;top:6px;background:#ff3b30;color:white;padding:4px 7px;border-radius:999px;font-size:12px}

    /* ---------- HERO ---------- */
    .hero{max-width:1200px;margin:28px auto;padding:28px 20px;display:grid;grid-template-columns:1fr 420px;gap:24px;align-items:center}
    .hero-card{background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(255,255,255,0.75));padding:28px;border-radius:16px;box-shadow:var(--shadow)}
    .kicker{display:inline-block;padding:8px 12px;border-radius:999px;background:#eef6ff;color:var(--accent);font-weight:700;margin-bottom:12px}
    h1{margin:0 0 12px;font-size:28px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .cta{display:flex;gap:12px}
    .btn{padding:12px 16px;border-radius:12px;border:none;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--accent);color:white}
    .btn-ghost{background:transparent;border:1px solid #e6eefc}

    /* ---------- FILTERS & GRID ---------- */
    .controls{max-width:1200px;margin:12px auto 0;padding:0 20px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .categories{display:flex;gap:8px}
    .pill{padding:8px 12px;border-radius:999px;background:white;border:1px solid #edf2ff;cursor:pointer}
    .pill.active{background:linear-gradient(90deg,#e8f2ff,#eafcff);border-color:#cfe9ff}

    .grid-wrap{max-width:1200px;margin:18px auto;padding:20px}
    .products{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}

    .product{background:var(--card-bg);border-radius:14px;padding:14px;box-shadow:0 6px 20px rgba(2,6,23,0.06);transition:transform .18s ease,box-shadow .18s ease}
    .product:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(2,6,23,0.08)}
    .prod-img{height:180px;border-radius:10px;overflow:hidden;background:#f3f7ff;display:flex;align-items:center;justify-content:center}
    .prod-img img{width:100%;height:100%;object-fit:cover}
    .prod-body{padding:10px}
    .prod-title{font-weight:700;margin:6px 0}
    .prod-meta{color:var(--muted);font-size:14px}
    .price-add{display:flex;align-items:center;justify-content:space-between;margin-top:12px}
    .price{font-weight:800}
    .add{padding:8px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,#ff7a00,#ffb86b);color:white;cursor:pointer}

    /* ---------- CART MODAL ---------- */
    .modal{position:fixed;right:20px;bottom:20px;width:380px;background:linear-gradient(180deg,white,#fbfbff);border-radius:16px;box-shadow:0 18px 50px rgba(2,6,23,0.18);z-index:1500;display:none;flex-direction:column;overflow:hidden}
    .modal.open{display:flex}
    .modal-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #f1f5f9}
    .modal-body{padding:12px;max-height:320px;overflow:auto}
    .cart-item{display:flex;gap:10px;align-items:center;padding:10px 0;border-bottom:1px dashed #f3f4f6}
    .cart-item img{width:60px;height:60px;object-fit:cover;border-radius:8px}
    .qty{display:flex;gap:8px;align-items:center}
    .qty button{padding:6px 8px;border-radius:8px;border:1px solid #e6eefc;background:white;cursor:pointer}
    .remove{background:transparent;border:none;color:#ff3b30;cursor:pointer}
    .modal-footer{padding:12px 16px;border-top:1px solid #f1f5f9;display:flex;justify-content:space-between;align-items:center}

    /* ---------- RESPONSIVE ---------- */
    @media(max-width:980px){.products{grid-template-columns:repeat(2,1fr)}.hero{grid-template-columns:1fr}
      .search{min-width:140px}
    }
    @media(max-width:640px){.products{grid-template-columns:1fr}
      .nav ul{display:none}
      .hero{padding:12px}
    }

    /* ---------- Subtle animations ---------- */
    .fade-in{animation:fadein .5s ease}
    @keyframes fadein{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  </style>
</head>
<body>

  <header>
    <div class="nav">
      <div class="brand">
        <div class="logo">SM</div>
        <div>
          <div style="font-size:14px;color:var(--muted)">Marketplace</div>
          <div style="font-size:18px">SEN MARCH√â</div>
        </div>
      </div>

      <nav>
        <ul>
          <li><a href="#">Accueil</a></li>
          <li><a href="#products">Produits</a></li>
          <li><a onclick="openSell()">Vendre</a></li>
          <li><a onclick="openSellerTable()">Tableau de vendre</a></li>
          
        </ul>
      </nav>

      <div class="search-wrap">
        <input class="search" id="search" placeholder="Recherche en temps r√©el...">
        <button class="cart-btn" id="openCart">Panier <span class="badge" id="cartCount">0</span></button>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="hero-card fade-in">
        <span class="kicker">March√© local</span>
        <h1>Bienvenue sur SEN MARCH√â ‚Äî Acheter et vendre localement</h1>
        <p class="lead">Une marketplace s√©curis√©e o√π les vendeurs exposent leurs produits et les acheteurs ach√®tent facilement. Inscription obligatoire pour publier un produit.</p>
        <div class="cta">
          <button class="btn btn-primary" onclick="scrollToProducts()">Voir les produits</button>
          <button class="btn btn-ghost" onclick="openRegister()">S'inscrire</button>
        </div>
      </div>

      <div class="hero-card fade-in" style="text-align:center">
        <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=abc" alt="march√©" style="width:100%;border-radius:12px;height:260px;object-fit:cover">
      </div>
    </section>

    <!-- Controls -->
    <section class="controls">
      <div class="categories" id="categories">
        <div class="pill active" data-cat="all">Tous</div>
        <div class="pill" data-cat="electronique">√âlectronique</div>
        <div class="pill" data-cat="mode">Mode</div>
        <div class="pill" data-cat="maison">Maison</div>
      </div>

      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <span class="small">Filtrer</span>
      </div>
    </section>

    <!-- Products grid -->
    <section id="products" class="grid-wrap">
      <div class="products" id="productGrid"></div>
    </section>

    <!-- Cart modal -->
    <div class="modal" id="cartModal" aria-hidden="true">
      <div class="modal-header">
        <div style="font-weight:700">Panier</div>
        <div>
          <button style="border:none;background:transparent;cursor:pointer;font-weight:700" id="closeCart">Fermer</button>
        </div>
      </div>
      <div class="modal-body" id="cartBody"></div>
      <div class="modal-footer">
        <div>
          <div style="font-size:12px;color:var(--muted)">Total</div>
          <div style="font-weight:800" id="cartTotal">0 FCFA</div>
        </div>
        <div>
          <button class="btn btn-primary" id="checkoutBtn">Passer √† la caisse</button>
        </div>
      </div>
    </div>

    <!-- Registration modal -->
    <div id="register" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.4);align-items:center;justify-content:center;z-index:1600">
      <div style="background:white;padding:20px;border-radius:12px;width:360px;box-shadow:var(--shadow)">
        <h3>Cr√©er un compte</h3>
        <input id="r_nom" placeholder="Nom" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #eef4ff">
        <input id="r_prenom" placeholder="Pr√©nom" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #eef4ff">
        <input id="r_email" placeholder="Email" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #eef4ff">
        <input id="r_pass" placeholder="Mot de passe" type="password" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #eef4ff">
        <div style="display:flex;gap:8px;margin-top:8px"><button class="btn btn-primary" onclick="registerUser()">S'inscrire</button><button class="btn btn-ghost" onclick="closeRegister()">Annuler</button></div>
      </div>
    </div>

    <!-- Sell modal -->
    <div id="sellModal" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.4);align-items:center;justify-content:center;z-index:1600">
      <div style="background:white;padding:20px;border-radius:12px;width:360px;box-shadow:var(--shadow)">
        <h3>Ajouter un produit</h3>
        <input id="s_title" placeholder="Nom du produit" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #eef4ff">
        <input id="s_price" type="number" placeholder="Prix" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #eef4ff">
        <select id="s_cat" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #eef4ff">
          <option value="">S√©lectionner la cat√©gorie</option>
          <option value="electronique">√âlectronique</option>
          <option value="mode">Mode</option>
          <option value="maison">Maison</option>
        </select>
        <input type="file" id="s_img_file" accept="image/*" style="width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #eef4ff">

        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn btn-primary" onclick="addProduct()">Ajouter</button>
          <button class="btn btn-ghost" onclick="closeSell()">Annuler</button>
        </div>
      </div>
    </div>

    <!-- Seller table modal -->
    <div id="sellerTableModal" style="display:none;position:fixed;inset:0;background:rgba(2,6,23,0.4);align-items:center;justify-content:center;z-index:1600">
      <div style="background:white;padding:20px;border-radius:12px;width:400px;box-shadow:var(--shadow);max-height:80%;overflow:auto">
        <h3>Mes produits</h3>
        <div id="sellerProducts"></div>
        <div style="margin-top:12px;text-align:right">
          <button class="btn btn-ghost" onclick="closeSellerTable()">Fermer</button>
        </div>
      </div>
    </div>

  </main>
  <!-- Payment modal pour publier un produit -->
<div id="publishPaymentModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:1800">
  <div style="background:white;padding:20px;border-radius:12px;width:360px;box-shadow:var(--shadow)">
    <h3>Paiement pour publier un produit</h3>
    <div style="margin-bottom:12px">Montant : <strong>500 FCFA</strong></div>
    <select id="publishPaymentSelect" style="width:100%;padding:8px;border-radius:8px;border:1px solid #eef4ff;margin-bottom:12px">
      <option value="">Choisir le mode de paiement</option>
      <option value="cash">Esp√®ces</option>
      <option value="card">Carte bancaire</option>
      <option value="mobile">Mobile Money</option>
    </select>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button class="btn btn-primary" id="confirmPublishPayment">Payer & Publier</button>
      <button class="btn btn-ghost" onclick="document.getElementById('publishPaymentModal').style.display='none'">Annuler</button>
    </div>
  </div>
</div>

<!-- Chat flottant -->
<div id="chatWidget" style="position:fixed;bottom:20px;right:20px;z-index:2000">
  <div id="chatToggle" 
       style="width:60px;height:60px;border-radius:50%;background:#0d6efd;color:white;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;box-shadow:0 6px 15px rgba(0,0,0,0.2)">
    üí¨
  </div>
  <div id="chatBox" style="display:none;width:320px;height:400px;background:white;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.3);overflow:hidden;display:flex;flex-direction:column;margin-bottom:10px">
    <div id="chatHeader" style="padding:12px;background:#0d6efd;color:white;font-weight:700;display:flex;justify-content:space-between;align-items:center">
      Support
      <span id="chatClose" style="cursor:pointer;font-weight:700">‚úñ</span>
    </div>
    <div id="chatMessages" style="flex:1;padding:10px;overflow-y:auto;display:flex;flex-direction:column;gap:6px;background:#f5f5f5"></div>
    <div id="chatInputContainer" style="padding:8px;border-top:1px solid #e6eefc;display:flex;gap:6px">
      <input id="chatInput" placeholder="√âcrire un message..." 
             style="flex:1;padding:8px;border-radius:8px;border:1px solid #ccc">
      <button id="chatSendBtn" 
              style="padding:8px 12px;background:#0d6efd;color:white;border:none;border-radius:8px;cursor:pointer">
        Envoyer
      </button>
    </div>
  </div>
</div>




  <footer>
    <div class="foot-wrap">
      <div>
        <div style="font-weight:700">SEN MARCH√â</div>
        <div class="small">Marketplace locale ‚Äî Acheter & vendre en toute s√©curit√©</div>
      </div>
      <div class="small">¬© SEN MARCH√â ‚Äî 2025</div>
    </div>
  </footer>

  <script>

    // ---------- Chat flottant ----------
let chatOpen = false;
const chatWidget = document.getElementById('chatWidget');
const chatToggle = document.getElementById('chatToggle');
const chatBox = document.getElementById('chatBox');
const chatClose = document.getElementById('chatClose');
const chatMessagesDiv = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const chatSendBtn = document.getElementById('chatSendBtn');

let chatMessages = JSON.parse(localStorage.getItem('sen_chat_messages') || '[]');

function renderChat() {
  chatMessagesDiv.innerHTML = '';
  chatMessages.forEach(m => {
    const div = document.createElement('div');
    div.style.maxWidth = '80%';
    div.style.padding = '6px 10px';
    div.style.borderRadius = '12px';
    div.style.wordBreak = 'break-word';
    div.style.fontSize = '14px';
    if (m.user === 'Vous') {
      div.style.alignSelf = 'flex-end';
      div.style.background = '#0d6efd';
      div.style.color = 'white';
    } else {
      div.style.alignSelf = 'flex-start';
      div.style.background = '#e2e6ea';
      div.style.color = '#0f172a';
    }
    div.textContent = m.user + ': ' + m.text;
    chatMessagesDiv.appendChild(div);
  });
  chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
}

// Ouvrir/fermer chat
chatToggle.onclick = () => {
  chatOpen = !chatOpen;
  chatBox.style.display = chatOpen ? 'flex' : 'none';
};
chatClose.onclick = () => { chatOpen = false; chatBox.style.display = 'none'; };

// Envoyer message
function sendMessage() {
  const text = chatInput.value.trim();
  if(!text) return;
  chatMessages.push({user:'Vous', text});
  localStorage.setItem('sen_chat_messages', JSON.stringify(chatMessages));
  chatInput.value = '';
  renderChat();

  // R√©ponse automatique simul√©e
  setTimeout(() => {
    chatMessages.push({user:'Support', text:'Merci pour votre message ! Nous reviendrons vers vous rapidement.'});
    localStorage.setItem('sen_chat_messages', JSON.stringify(chatMessages));
    renderChat();
  }, 1000);
}

chatSendBtn.onclick = sendMessage;
chatInput.addEventListener('keypress', e => { if(e.key === 'Enter') sendMessage(); });

// Initial render
renderChat();


// Initial render
renderChat();

function addProduct(){
  const title = document.getElementById('s_title').value.trim();
  const price = Number(document.getElementById('s_price').value);
  const cat = document.getElementById('s_cat').value;
  const fileInput = document.getElementById('s_img_file');
const file = fileInput.files[0];
if(!file){ alert('Veuillez s√©lectionner une image'); return; }

const reader = new FileReader();
reader.onload = function(event){
    const img = event.target.result; // Image en Base64
    const id = Date.now();
    const newProd = {id, title, price, cat, img};
    state.sellerProducts.push(newProd);
    state.products.push(newProd);
    localStorage.setItem('sen_seller', JSON.stringify(state.sellerProducts));
    renderProducts();
    closeSell();
    alert('Produit ajout√© avec succ√®s !');

    // R√©initialiser le formulaire
    document.getElementById('s_title').value = '';
    document.getElementById('s_price').value = '';
    document.getElementById('s_cat').value = '';
    fileInput.value = '';
};
reader.readAsDataURL(file);


  if(!title || !price || !cat || !img){alert('Remplissez tous les champs'); return;}
  if(!state.user){alert('Vous devez √™tre connect√© pour publier un produit'); openRegister(); return;}

  // Stock temporaire du produit
  state.tempProduct = {title, price, cat, img};

  // Ouvrir le modal paiement
  document.getElementById('publishPaymentModal').style.display = 'flex';
}
document.getElementById('confirmPublishPayment').onclick = function(){
  const mode = document.getElementById('publishPaymentSelect').value;
  if(!mode){alert('Veuillez choisir un mode de paiement'); return;}

  // Ici tu peux int√©grer un vrai paiement Mobile Money ou carte
  alert(`Paiement de 500 FCFA re√ßu via ${mode}. Produit publi√© !`);

  // Publier le produit
  const newProd = {id: Date.now(), ...state.tempProduct};
  state.sellerProducts.push(newProd);
  state.products.push(newProd);
  localStorage.setItem('sen_seller', JSON.stringify(state.sellerProducts));

  renderProducts();
  document.getElementById('publishPaymentModal').style.display = 'none';
  document.getElementById('s_title').value = '';
  document.getElementById('s_price').value = '';
  document.getElementById('s_cat').value = '';
  document.getElementById('s_img').value = '';
};

function addProduct(){
  const title = document.getElementById('s_title').value.trim();
  const price = Number(document.getElementById('s_price').value);
  const cat = document.getElementById('s_cat').value;
  const img = document.getElementById('s_img').value.trim();

  if(!title || !price || !cat || !img){alert('Remplissez tous les champs'); return;}
  
  if(!state.user){alert('Vous devez √™tre connect√© pour publier un produit'); openRegister(); return;}

  // Demander le paiement
  const pay = confirm(`Pour publier ce produit, vous devez payer ${PUBLISH_FEE} FCFA. Confirmez le paiement.`);
  if(!pay){alert('Publication annul√©e'); return;}

  // Ici tu peux int√©grer un vrai syst√®me de paiement (Mobile Money, PayPal, carte)
  alert('Paiement re√ßu ! Vous pouvez publier votre produit.');

  const id = Date.now();
  const newProd = {id,title,price,cat,img};
  state.sellerProducts.push(newProd);
  state.products.push(newProd);
  localStorage.setItem('sen_seller',JSON.stringify(state.sellerProducts));
  renderProducts(); closeSell();
  alert('Produit ajout√© avec succ√®s !');
}

    // ---------- DATA ----------
    const PRODUCTS = [
       

  
      {id:1,title:"Smartphone Android",cat:"electronique",price:75000,img:"https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=1"},
      {id:2,title:"√âcouteurs sans fil",cat:"electronique",price:15000,img:"airpod.jpg"},
      {id:3,title:"Montre connect√©e",cat:"electronique",price:42000,img:"montre.jpg"},
      {id:4,title:"sac a dos",cat:"mode",price:12000,img:"sac a dos.jpg"},
      {id:5,title:"Sac √† main",cat:"mode",price:9000,img:"sac a main.jpg"},
      {id:6,title:"T-shirt unisexe",cat:"mode",price:3500,img:"tshirt.jpg"},
      {id:7,title:"couteaux ",cat:"maison",price:8000,img:"couteau.jpg"},
      {id:8,title:"Couverture chaleureuse",cat:"maison",price:6000,img:"couette.jpg"},
      {id:9,title:"Lampe LED d√©co",cat:"maison",price:4500,img:"led decoration.jpg"},
      {id:10,title:"gateau d'anniversaire",cat:"maison",price:4500,img:"cake.jpg"},
      {id:12,title:"congelateur",cat:"maison",price:100000,img:"frigo.jpg"},
      {id:13,title:"lumineuse led",cat:"maison",price:4500,img:"decoration.jpg"},
      {id:14,title:"legumes",cat:"maison",price:5000,img:"legumes.jpg"},
      {id:15,title:"machine a laver",cat:"electronique",price:75000,img:"machine a laver.jpg"},
      {id:14,title:"mixeur electrique",cat:"electronique",price:20000,img:"mixeur electrique.jpg"},
      {id:15,title:"bruleur",cat:"maison",price:5000,img:"bruleur.jpg"},
      {id:16,title:"altere",cat:"maison",price:13000,img:"altere .jpg"},
      {id:17,title:"chaine",cat:"mode",price:6000,img:"chaine.jpg"},
      {id:18,title:"elastique",cat:"maison",price:1800,img:"elastique.jpg"},
      {id:19,title:"nue pied",cat:"mode",price:2000,img:"nue pied.jpg"},
      {id:20,title:"parfum",cat:"mode",price:9000,img:"parfum.jpg"},
      {id:21,title:"playstation 5",cat:"maison",price:35000,img:"playstation.jpg"},
      {id:22,title:"plots",cat:"maison",price:4200,img:"plots.jpg"},
      {id:23,title:"savon",cat:"maison",price:300,img:"savon .jpg"},
     
   

     
    ];

    // ---------- STATE ----------
    let state = {
      products: PRODUCTS,
      filter: 'all',
      query: '',
      cart: JSON.parse(localStorage.getItem('sen_cart')||'[]'),
      user: JSON.parse(localStorage.getItem('sen_user')||'null'),
      sellerProducts: JSON.parse(localStorage.getItem('sen_seller')||'[]')
    };

    // ---------- RENDER PRODUCTS ----------
    const productGrid = document.getElementById('productGrid');
    function renderProducts(){
      const list = state.products.filter(p=> (state.filter==='all'||p.cat===state.filter) && p.title.toLowerCase().includes(state.query.toLowerCase()));
      productGrid.innerHTML = '';
      list.forEach(p=>{
        const el = document.createElement('div');el.className='product';
        el.innerHTML = `
          <div class="prod-img"><img src="${p.img}" alt="${p.title}"></div>
          <div class="prod-body">
            <div class="prod-title">${p.title}</div>
            <div class="prod-meta">Cat√©gorie: ${p.cat}</div>
            <div class="price-add"><div class="price">${p.price.toLocaleString()} FCFA</div><button class="add" data-id="${p.id}">Ajouter</button></div>
          </div>
        `;
        productGrid.appendChild(el);
      });
      attachAddListeners();
    }

    // ---------- SEARCH & FILTER ----------
    const search = document.getElementById('search');
    const cats = document.getElementById('categories');
    search.addEventListener('input',e=>{state.query=e.target.value;renderProducts();});
    cats.addEventListener('click',e=>{
      if(e.target.dataset.cat){
        document.querySelectorAll('.pill').forEach(p=>p.classList.remove('active'));
        e.target.classList.add('active');
        state.filter=e.target.dataset.cat;
        renderProducts();
      }
    });

    // ---------- CART MANAGEMENT ----------
    const cartModal = document.getElementById('cartModal');
    const cartBody = document.getElementById('cartBody');
    const cartCount = document.getElementById('cartCount');
    const cartTotal = document.getElementById('cartTotal');

    function saveCart(){localStorage.setItem('sen_cart',JSON.stringify(state.cart));}

    function openCart(){cartModal.classList.add('open');renderCart();}
    function closeCart(){cartModal.classList.remove('open');}

    document.getElementById('openCart').addEventListener('click',openCart);
    document.getElementById('closeCart').addEventListener('click',closeCart);

    function attachAddListeners(){document.querySelectorAll('.add').forEach(btn=>{btn.onclick=()=>{const id=Number(btn.dataset.id);addToCart(id);}});} 

    function addToCart(id){
      const prod = state.products.find(p=>p.id===id);
      if(!prod) return;
      const found = state.cart.find(c=>c.id===id);
      if(found){found.q++} else {state.cart.push({id:prod.id,title:prod.title,price:prod.price,img:prod.img,q:1})}
      saveCart();updateBadge();renderCart();
    }

    function updateBadge(){cartCount.textContent=state.cart.reduce((s,i)=>s+i.q,0)}

    function renderCart(){
      cartBody.innerHTML='';
      if(state.cart.length===0){cartBody.innerHTML='<div style="padding:20px;text-align:center;color:var(--muted)">Votre panier est vide</div>';cartTotal.textContent='0 FCFA';updateBadge();return}
      state.cart.forEach(item=>{
        const div=document.createElement('div');div.className='cart-item';
        div.innerHTML=`
          <img src="${item.img}" alt="${item.title}">
          <div style="flex:1">
            <div style="font-weight:700">${item.title}</div>
            <div style="color:var(--muted);font-size:13px">${item.price.toLocaleString()} FCFA</div>
          </div>
          <div style="text-align:right">
            <div class="qty">
              <button data-id="${item.id}" class="dec">-</button>
              <div style="min-width:28px;text-align:center">${item.q}</div>
              <button data-id="${item.id}" class="inc">+</button>
            </div>
            <div><button class="remove" data-id="${item.id}">Supprimer</button></div>
          </div>
        `;
        cartBody.appendChild(div);
      });

      cartBody.querySelectorAll('.inc').forEach(b=>b.onclick=()=>{changeQty(Number(b.dataset.id),1)});
      cartBody.querySelectorAll('.dec').forEach(b=>b.onclick=()=>{changeQty(Number(b.dataset.id),-1)});
      cartBody.querySelectorAll('.remove').forEach(b=>b.onclick=()=>{removeItem(Number(b.dataset.id))});

      const total = state.cart.reduce((s,i)=>s+i.price*i.q,0);
      cartTotal.textContent = total.toLocaleString() + ' FCFA';
      updateBadge();
    }

    function changeQty(id,delta){const it=state.cart.find(c=>c.id===id); if(!it) return; it.q+=delta; if(it.q<1) it.q=1; saveCart(); renderCart();}
    function removeItem(id){state.cart = state.cart.filter(c=>c.id!==id); saveCart(); renderCart();}

    // ---------- CHECKOUT ----------
    document.getElementById('checkoutBtn').addEventListener('click',()=>{
      if(state.cart.length===0){alert('Votre panier est vide');return}
      if(!state.user){if(!confirm('Vous devez √™tre connect√© pour passer commande. Voulez-vous cr√©er un compte maintenant ?')) return; openRegister(); return}
      alert('Commande pass√©e ! Montant: ' + state.cart.reduce((s,i)=>s+i.price*i.q,0).toLocaleString() + ' FCFA');
      state.cart = []; saveCart(); renderCart(); closeCart();
    });

    // ---------- REGISTER ----------
    function openRegister(){document.getElementById('register').style.display='flex'}
    function closeRegister(){document.getElementById('register').style.display='none'}
    function registerUser(){
      const nom = document.getElementById('r_nom').value.trim();
      const prenom = document.getElementById('r_prenom').value.trim();
      const mail = document.getElementById('r_email').value.trim();
      const pass = document.getElementById('r_pass').value.trim();
      if(!nom||!prenom||!mail||!pass){alert('Remplissez tous les champs');return}
      state.user = {nom,prenom,mail};
      localStorage.setItem('sen_user',JSON.stringify(state.user));
      alert('Compte cr√©√© ‚Äî Bienvenue '+prenom+' !'); closeRegister();
    }

    // ---------- SELL MODAL ----------
    const sellModal = document.getElementById('sellModal');
    const sellerTableModal = document.getElementById('sellerTableModal');
    function openSell(){sellModal.style.display='flex'}
    function closeSell(){sellModal.style.display='none'}
    function openSellerTable(){renderSellerProducts();sellerTableModal.style.display='flex'}
    function closeSellerTable(){sellerTableModal.style.display='none'}

    function addProduct(){
      const title=document.getElementById('s_title').value.trim();
      const price=Number(document.getElementById('s_price').value);
      const cat=document.getElementById('s_cat').value;
      const img=document.getElementById('s_img').value.trim();
      if(!title||!price||!cat||!img){alert('Remplissez tous les champs');return;}
      const id=Date.now();
      const newProd={id,title,price,cat,img};
      state.sellerProducts.push(newProd);
      state.products.push(newProd);
      localStorage.setItem('sen_seller',JSON.stringify(state.sellerProducts));
      renderProducts(); closeSell();
      alert('Produit ajout√© avec succ√®s !');
    }

    function renderSellerProducts(){
      const div=document.getElementById('sellerProducts');
      div.innerHTML='';
      if(state.sellerProducts.length===0){div.innerHTML='<div style="color:var(--muted);text-align:center;padding:10px">Aucun produit</div>'; return;}
      state.sellerProducts.forEach(p=>{
        const d=document.createElement('div');d.style.display='flex';d.style.justifyContent='space-between';d.style.marginBottom='8px';
        d.innerHTML=`<span>${p.title} (${p.price.toLocaleString()} FCFA)</span><button class="btn btn-ghost" onclick="deleteSellerProduct(${p.id})">Supprimer</button>`;
        div.appendChild(d);
      });
    }

    function deleteSellerProduct(id){
      state.sellerProducts=state.sellerProducts.filter(p=>p.id!==id);
      state.products=state.products.filter(p=>!(p.id===id && state.sellerProducts.find(sp=>sp.id===id)===undefined));
      localStorage.setItem('sen_seller',JSON.stringify(state.sellerProducts));
      renderProducts();
      renderSellerProducts();
    }

    // ---------- UTILITIES ----------
    function scrollToProducts(){document.getElementById('products').scrollIntoView({behavior:'smooth'})}

    // ---------- INIT ----------
    renderProducts();updateBadge();
    PRODUCTS.forEach(p=>{const i=new Image();i.src=p.img});

    // ---------- COMMENTS ----------
function openCommentModal(prodId){
  let modal = document.getElementById('commentModal');
  if(!modal){
    modal = document.createElement('div');
    modal.id='commentModal';
    modal.style.cssText='display:flex;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:1700';
    modal.innerHTML=`
      <div style="background:white;padding:20px;border-radius:12px;width:360px;box-shadow:var(--shadow);max-height:80%;overflow:auto">
        <h3>Commentaires</h3>
        <div id="commentList" style="max-height:200px;overflow:auto;margin-bottom:10px"></div>
        <input id="commentInput" placeholder="Votre commentaire" style="width:100%;padding:8px;margin-bottom:8px;border-radius:8px;border:1px solid #eef4ff">
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button class="btn btn-primary" id="sendCommentBtn">Envoyer</button>
          <button class="btn btn-ghost" id="closeCommentBtn">Fermer</button>
        </div>
      </div>
    `;
    document.body.appendChild(modal);
    document.getElementById('closeCommentBtn').onclick=()=>{modal.style.display='none';};
  }
  
  const comments = JSON.parse(localStorage.getItem('sen_comments')||'{}');
  const list = comments[prodId]||[];
  const commentListDiv = document.getElementById('commentList');
  commentListDiv.innerHTML = list.map(c=>`<div style="padding:4px 0;border-bottom:1px dashed #eee">${c}</div>`).join('');

  document.getElementById('sendCommentBtn').onclick = ()=>{
    const val = document.getElementById('commentInput').value.trim();
    if(!val) return;
    if(!comments[prodId]) comments[prodId]=[];
    comments[prodId].push(val);
    localStorage.setItem('sen_comments',JSON.stringify(comments));
    document.getElementById('commentInput').value='';
    openCommentModal(prodId); // refresh
  };

  modal.style.display='flex';
}

// Ajouter bouton commentaire sous chaque produit
function attachCommentButtons(){
  document.querySelectorAll('.product').forEach(el=>{
    if(el.querySelector('.commentBtn')) return; // pas de double ajout
    const btn = document.createElement('button');
    btn.className='add commentBtn';
    btn.style.background='linear-gradient(90deg,#6c5ce7,#a29bfe)';
    btn.style.marginTop='6px';
    btn.textContent='Commentaires';
    btn.onclick=()=>{ 
      const id = Number(el.querySelector('.add')?.dataset?.id || el.querySelector('.prod-title')?.dataset?.id);
      if(!id) return;
      openCommentModal(id);
    };
    el.querySelector('.prod-body').appendChild(btn);
  });
}

// Appliquer apr√®s le rendu des produits
const originalRenderProducts = renderProducts;
renderProducts = function(){
  originalRenderProducts();
  attachCommentButtons();
};
renderProducts();

// ---------- PAYMENT ----------
function injectPaymentOptions(){
  const footer = cartModal.querySelector('.modal-footer');
  if(cartModal.querySelector('#paymentSelect')) return;

  const div = document.createElement('div');
  div.style.marginRight='12px';
  div.innerHTML=`
    <select id="paymentSelect" style="padding:6px;border-radius:8px;border:1px solid #eef4ff">
      <option value="">Choisir le mode de paiement</option>
      <option value="cash">Esp√®ces</option>
      <option value="card">Carte bancaire</option>
      <option value="mobile">Mobile Money</option>
    </select>
  `;
  footer.insertBefore(div, footer.children[1]); // avant le bouton "Passer √† la caisse"
}

document.getElementById('checkoutBtn').onclick = ()=>{
  if(state.cart.length===0){alert('Votre panier est vide');return}
  if(!state.user){if(!confirm('Vous devez √™tre connect√© pour passer commande. Voulez-vous cr√©er un compte maintenant ?')) return; openRegister(); return}

  const mode = document.getElementById('paymentSelect')?.value;
  if(!mode){alert('Veuillez choisir un mode de paiement'); injectPaymentOptions(); return;}

  alert('Commande pass√©e ! Montant: ' + state.cart.reduce((s,i)=>s+i.price*i.q,0).toLocaleString() + ' FCFA\nMode de paiement: '+mode);

  state.cart = []; saveCart(); renderCart(); closeCart();
}

// Injecter les options √† chaque ouverture du panier
document.getElementById('openCart').addEventListener('click', injectPaymentOptions);


function addProduct() {
  const title = document.getElementById('s_title').value.trim();
  const price = Number(document.getElementById('s_price').value);
  const cat = document.getElementById('s_cat').value;
  const fileInput = document.getElementById('s_img_file');
  const file = fileInput.files[0];

  if (!title || !price || !cat || !file) {
    alert('Remplissez tous les champs et s√©lectionnez une image');
    return;
  }

  const reader = new FileReader();
  reader.onload = function(event) {
    const img = event.target.result; // Base64 de l'image
    const id = Date.now();
    const newProd = { id, title, price, cat, img };
    state.sellerProducts.push(newProd);
    state.products.push(newProd);
    localStorage.setItem('sen_seller', JSON.stringify(state.sellerProducts));
    renderProducts();
    closeSell();
    alert('Produit ajout√© avec succ√®s !');

    // R√©initialiser le formulaire
    document.getElementById('s_title').value = '';
    document.getElementById('s_price').value = '';
    document.getElementById('s_cat').value = '';
    fileInput.value = '';
  };
  reader.readAsDataURL(file);
}
 
function addProduct() {
  const title = document.getElementById('s_title').value.trim();
  const price = Number(document.getElementById('s_price').value);
  const cat = document.getElementById('s_cat').value;
  const fileInput = document.getElementById('s_img_file');
  const file = fileInput.files[0];

  if (!title || !price || !cat || !file) {
    alert('Remplissez tous les champs et s√©lectionnez une image');
    return;
  }

  // Demander le mode de paiement avant d'ajouter le produit
  const mode = prompt("Choisissez le mode de paiement pour publier (cash, card, mobile) :");
  if (!mode || !['cash', 'card', 'mobile'].includes(mode.toLowerCase())) {
    alert("Paiement annul√© ou mode invalide.");
    return;
  }

  // Simuler le paiement
  alert(`Paiement de 500 FCFA re√ßu via ${mode}. Produit publi√© !`);

  // Lire l'image et ajouter le produit
  const reader = new FileReader();
  reader.onload = function(event) {
    const img = event.target.result;
    const id = Date.now();
    const newProd = { id, title, price, cat, img };
    state.sellerProducts.push(newProd);
    state.products.push(newProd);
    localStorage.setItem('sen_seller', JSON.stringify(state.sellerProducts));
    renderProducts();
    closeSell();
    alert('Produit ajout√© avec succ√®s !');

    // R√©initialiser le formulaire
    document.getElementById('s_title').value = '';
    document.getElementById('s_price').value = '';
    document.getElementById('s_cat').value = '';
    fileInput.value = '';
  };
  reader.readAsDataURL(file);
}


  </script>
</body>
</html>
